<?php//require_once(ROOT_DIR."/classes/entities/band.php");class PlanetInterface extends BasicInterface {		public function __construct($db = null) {		parent::__construct($db);	}		public function getPlanetOverview($data)	{		$q = 'SELECT `pl_galaxie`,count(`pl_galaxie`) as pl_count FROM `planeten` group by `pl_galaxie` order by `pl_galaxie`';				$result=$this->db->query($q);		$html = '';		$resultData = new StdClass;		if ($this->db->get_last_num_rows() > 0)		{ 			$resultData->planetenverteilung = array();						while ($row = mysql_fetch_array($result, MYSQL_ASSOC)) 			{				$planetenrow = array();				$planetenrow[] = $row['pl_galaxie'];				$planetenrow[] = $row['pl_count'];				$resultData->planetenverteilung[] = $planetenrow;			}			$html .= '<div id="planetenverteilung"></div>';					}		$resultData->html = $html;		return new DataResponse(ResultTypes::resultOK,"getPlanetOverview",$resultData);	}		public function getPlayerByPlanet($data)	{		$q = "Select pl_spieler from planeten where pl_galaxie = ".$data->galaxy." AND pl_system =  ".$data->system." AND pl_planet =  ".$data->planet;				$result=$this->db->query($q);				$bla = 0;		$html = 'nicht gefunden';				if ($this->db->get_last_num_rows() > 0)		{ 			while ($row = mysql_fetch_array($result, MYSQL_ASSOC)) 			{				$html = $row['pl_spieler'];			}		}				$resultData = new stdClass;		$resultData->html = $html;		$resultData->player = $html;				return new DataResponse(ResultTypes::resultOK,"getPlayerByPlanet",$resultData);	}		public function getPlanetByPlayer($data)	{		$q = "SELECT CONCAT(  `pl_galaxie` ,  ':',  `pl_system` ,  ':',  `pl_planet` ) AS Planet,pl_name from planeten where pl_spieler = '".$data->player."' order by pl_galaxie,pl_system,pl_planet";				$result=$this->db->query($q);				$bla = 0;		$html = '';				if (isset($data->highscore) && $data->highscore)		{			$dt = isset($data->dotable) ? $data->dotable : false;			$hi = new HighscoreInterface();			$data->dotable = false;			$hs = $hi->getCompleteHighscore($data);			$html .= $hs->data->html;			$data->dotable = $dt;		}				$html .= '<p>'.$this->db->get_last_num_rows().' Planet'.($this->db->get_last_num_rows() != 1 ? 'en' : '' ).' gefunden</p>';								if ($this->db->get_last_num_rows() > 0)		{ 			//class="planetnumber';						$html .= $this->getHtmlTableOpen($this->getTableClasses($data));			$html .= $this->getHtmlTableHeader(['#','Planet','Name']);			$html .= '<tbody>';						while ($row = mysql_fetch_array($result, MYSQL_ASSOC)) 			{				$bla++;								$html .= '<tr><td>'.$bla.'</td>';								foreach($row as $key => $value)				{					preg_match("/([0-9]+):([0-9]+):([0-9]+)/",$row['Planet'],$planet);					if ($key == 'Planet')					{						$html .= '<td><a href="http://uni1.gigrawars.de/galaxie.php?to='.$value.'">'.$value.'</a>';						$html .= '<div title="Details: '.$row['Planet'].'" class="details icon" onclick="ajaxMessageBox(\'FarmInterface\',\'getFarmData\',{ galaxy:'.$planet[1].',system:'.$planet[2].',planet:'.$planet[3].', highscore: true })"></div></td>';					}					else 					{						$html .= '<td>'.$value.'</td>';					}											}				$html .= '</tr>';									if ($bla%30==29) 				{					$html .= '<tr>'.					'		<th class="planetnumber">'.					'		<th>Planet</th>'.					'		<th>Name</th>'.					'	</tr>';				}			}			$html .= '</tbody></table>';		}		else		{			$html .= '<p>Keine Planeten gefunden!</p>';		}				$resultData = new stdClass;		$resultData->html = $html;		$resultData->title = $data->player;				return new DataResponse(ResultTypes::resultOK,"getAllPlanets",$resultData);	}		public function getAllPlanets($data)	{		$where = " ";		if(isset($data->favoriten))		{			$where = " where sp_favorit = 1 ";		}		else		{			if (isset($data->galaxy) && ($data->galaxy != ""))			{				$where .= "where pl_galaxie = ".$data->galaxy." ";			}			if (isset($data->system) && ($data->system != ""))			{				$where .= ($where == " " ? "where" : "and")." pl_system = ".$data->system." ";			}		}				$q = "SELECT CONCAT(  `pl_galaxie` ,  ':',  `pl_system` ,  ':',  `pl_planet` ) AS Planet,pl_name,pl_spieler,sp_allianz,sp_favorit from planeten left outer join spieler on pl_spieler = sp_name".$where."order by pl_galaxie,pl_system,pl_planet";				$result=$this->db->query($q);				$bla = 0;				$html = '<p>'.$this->db->get_last_num_rows().' Planet'.($this->db->get_last_num_rows() != 1 ? 'en' : '' ).' gefunden</p>';						if ($this->db->get_last_num_rows() > 0)		{ 			$html .= $this->getHtmlTableOpen($this->getTableClasses($data));			$html .= $this->getHtmlTableHeader(['Planet','Name','Spieler','Allianz']);			$html .= '<tbody>';			while ($row = mysql_fetch_array($result, MYSQL_ASSOC)) 			{				$bla++;
				
				$html .= '<tr>';
								foreach($row as $key => $value)				{					preg_match("/([0-9]+):([0-9]+):([0-9]+)/",$row['Planet'],$planet);					if ($key == 'pl_spieler')					{						$html .= '<td><a href="http://uni1.gigrawars.de/playercard.php?p='.$row['Planet'].':1">'.$value.'</a>';												$html .= $this->getHtmlAllPlanetByPlayerIcon($row['pl_spieler']);						$html .= $this->getHtmlHighscoreHistoryIcon($row['pl_spieler']);						$html .= $this->getHtmlFavoritIcon($row['pl_spieler'],$row['sp_favorit']);											}					else					if ($key == 'Planet')					{						$html .= '<td><a href="http://uni1.gigrawars.de/galaxie.php?to='.$value.'">'.$value.'</a>';						$html .= '<div title="Details: '.$row['Planet'].'" class="details icon" onclick="ajaxMessageBox(\'FarmInterface\',\'getFarmData\',{ galaxy:'.$planet[1].',system:'.$planet[2].',planet:'.$planet[3].', highscore: true })"></div></td>';											}					else if ($key=='sp_allianz')					{						if ($value != '')						{							$html .= '<td>'.$value.'<div title="Allianz: '.$row['sp_allianz'].'" class="ally icon" onclick="ajaxMessageBox(\'HighscoreInterface\',\'getAllyDetails\',{ ally:\''.$row['sp_allianz'].'\', highscore: true })"></div></td>';						}						else						{							$html .= '<td>'.$value.'</td>';						}					}					else if ($key!='sp_favorit')					{						$html .= '<td>'.$value.'</td>';					}				}				$html .= '</tr>';			}			$html .= '</tbody></table>';		}
		else
		{
			$html .= '<p>Keine Planeten gefunden!</p>';
		}				$resultData = new stdClass;		$resultData->html = $html;				return new DataResponse(ResultTypes::resultOK,"getAllPlanets",$resultData);	}	}PlanetInterface::registerInterface();?>